<div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title><h1>Registro de equipo</h1></mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-horizontal-stepper [linear]="true">
        <mat-step [stepControl]="serviceForm">
          <ng-template matStepLabel>Datos básicos del servicio</ng-template>
          <form [formGroup]="serviceForm">
            <div class="form-element">
              <mat-form-field>
                <mat-label>Código</mat-label>
                <input
                  type="text"
                  matInput
                  placeholder="Ejemplo: 22at"
                  formControlName="code"
                />
                <mat-hint>Digite el código del servicio</mat-hint>
                <mat-error *ngIf="controls['code'].hasError('required')">
                  El código del servicio es requerido
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-element">
              <mat-form-field>
                <mat-label>Nombre</mat-label>
                <input
                  type="text"
                  matInput
                  placeholder="Ejemplo: Control de roedores"
                  formControlName="name"
                />
                <mat-hint>Digite el nombre del servicio</mat-hint>
                <mat-error *ngIf="controls['name'].hasError('required')">
                  El nombre del servicio es requerido
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-element form-select">
              <mat-form-field>
                <mat-label>Tipo de servicio</mat-label>
                <mat-select required formControlName="serviceType">
                  <mat-option
                    *ngFor="let serviceType of serviceTypes"
                    [value]="serviceType.id"
                  >
                    {{ serviceType.name }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="controls['serviceType'].hasError('required')">
                  Debe seleccionar el tipo de servicio
                </mat-error>
              </mat-form-field>
            </div>
            <div class="form-element">
              <mat-form-field>
                <mat-label>Costo</mat-label>
                <input
                  type="number"
                  matInput
                  placeholder="Ejemplo: 30000$"
                  formControlName="cost"
                />
                <mat-hint>Digite el costo del servicio</mat-hint>
                <mat-error *ngIf="controls['cost'].hasError('required')">
                  El precio del servicio es requerido
                </mat-error>
              </mat-form-field>
            </div>
          </form>
          <div class="form-buttons">
            <button matStepperNext mat-raised-button class="royal_azure">
              Siguiente
            </button>
          </div>
        </mat-step>
        <mat-step [stepControl]="serviceProductsForm">
          <ng-template matStepLabel>Productos utilizados</ng-template>
          <form [formGroup]="serviceProductsForm">
            <mat-form-field>
              <mat-label>Código de producto</mat-label>
              <input type="text" matInput [formControl]="productCode" />
              <mat-hint>Digite el código del producto a elegir</mat-hint>
            </mat-form-field>
            <mat-slide-toggle
              color="primary"
              [formControl]="showSelectedProducts"
            >
              Mostrar seleccionados
            </mat-slide-toggle>
            <mat-selection-list
              *ngIf="!(showSelectedProducts.valueChanges | async)"
              formControlName="productCodes"
              #productsListSelection="matSelectionList"
              (selectionChange)="onSelectProduct($event)"
            >
              <mat-list-option
                *ngFor="
                  let product of products
                    | filterProducts: (productCode.valueChanges | async)
                "
                [value]="product"
                color="primary"
              >
                {{ product.code }} - {{ product.name }}
              </mat-list-option>
            </mat-selection-list>
            <mat-list *ngIf="showSelectedProducts.valueChanges | async">
              <mat-list-item *ngFor="let product of selectedProducts">
                <mat-icon matListIcon>done</mat-icon>
                {{ product.code }} - {{ product.name }}
              </mat-list-item>
            </mat-list>
          </form>
          <div class="form-buttons">
            <button matStepperPrevious mat-raised-button>Regresar</button>
            <button matStepperNext mat-raised-button class="royal_azure">
              Siguiente
            </button>
          </div>
        </mat-step>
        <mat-step [stepControl]="serviceEquipmentsForm">
          <ng-template matStepLabel>Equipos necesarios</ng-template>
          <form [formGroup]="serviceEquipmentsForm">
            <mat-form-field>
              <mat-label>Código de equipo</mat-label>
              <input type="text" matInput [formControl]="equipmentCode" />
              <mat-hint>Digite el código del equipo a elegir</mat-hint>
            </mat-form-field>
            <mat-slide-toggle
              color="primary"
              [formControl]="showSelectedEquipments"
            >
              Mostrar seleccionados
            </mat-slide-toggle>
            <mat-selection-list
              *ngIf="!(showSelectedEquipments.valueChanges | async)"
              formControlName="equipmentCodes"
              #equipmentListSelection="matSelectionList"
              (selectionChange)="onSelectEquipment($event)"
            >
              <mat-list-option
                *ngFor="
                  let equipment of equipments
                    | filterEquipments: (equipmentCode.valueChanges | async)
                "
                [value]="equipment"
                color="primary"
              >
                {{ equipment.code }} - {{ equipment.name }}
              </mat-list-option>
            </mat-selection-list>
            <mat-list *ngIf="showSelectedEquipments.valueChanges | async">
              <mat-list-item *ngFor="let equipment of selectedEquipments">
                <mat-icon matListIcon>done</mat-icon>
                {{ equipment.code }} - {{ equipment.name }}
              </mat-list-item>
            </mat-list>
          </form>
          <div class="form-buttons">
            <button matStepperPrevious mat-raised-button>
              Regresar
            </button>
            <button matStepperNext mat-raised-button class="royal_azure">
              Siguiente
            </button>
          </div>
        </mat-step>
        <mat-step [stepControl]="serviceEmployeesForm">
          <ng-template matStepLabel>Empleados aptos</ng-template>
          <form [formGroup]="serviceEmployeesForm">
            <mat-form-field>
              <mat-label>Código de empleado</mat-label>
              <input type="text" matInput [formControl]="employeeCode" />
              <mat-hint>Digite el código del empleado a elegir</mat-hint>
            </mat-form-field>
            <mat-slide-toggle
              color="primary"
              [formControl]="showSelectedEmployees"
            >
              Mostrar seleccionados
            </mat-slide-toggle>
            <mat-selection-list
              *ngIf="!(showSelectedEmployees.valueChanges | async)"
              #employeeListSelection="matSelectionList"
              formControlName="employeeCodes"
              (selectionChange)="onSelectEmployee($event)"
            >
              <mat-list-option
                *ngFor="
                  let employee of employees
                    | filterEmployees: (employeeCode.valueChanges | async)
                "
                [value]="employee"
                color="primary"
              >
                {{ employee.id }} - {{ employee.firstName }}
                {{ employee.lastName }}
              </mat-list-option>
            </mat-selection-list>
            <mat-list *ngIf="showSelectedEmployees.valueChanges | async">
              <mat-list-item *ngFor="let employee of selectedEmployees">
                <mat-icon matListIcon>done</mat-icon>
                {{ employee.id }} - {{ employee.firstName }}
                {{ employee.lastName }}
              </mat-list-item>
            </mat-list>
          </form>
          <div class="form-buttons">
            <button matStepperPrevious mat-raised-button>
              Regresar
            </button>
            <button mat-raised-button (click)="onSubmit()" class="royal_azure">
              Registrar servicio
            </button>
          </div>
        </mat-step>
      </mat-horizontal-stepper>
    </mat-card-content>
  </mat-card>
</div>
